<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Add TOC indexes to PDF | Don&#39;t Panic!</title>
  <meta name="author" content="Farseer He">
  
  <meta name="description" content="PDF books without Indexes are like Planets with IndividualsI prefer e-books to paper books, actually I may have read only 1-2 paper books in recent 3 years, while e-books of a much larger amount. The pros of e-books are really obvious:

portability
context can be copied
easy to manage
easy to navigate

I don’t want to argue about the superiorities here. I just wanna to convey that the 4th feature is a crucial one, and it is mainly achieved via indexes, bookmarks, reference links, etc. There’s no doubt that among those approaches, indexes play the most significant role. So I say that e-books without indexes are like planets with individuals, i.e. huge gaps among separated pieces of text.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Add TOC indexes to PDF"/>
  <meta property="og:site_name" content="Don&#39;t Panic!"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Don&#39;t Panic!" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-40313156-5', 'auto');
	ga('send', 'pageview');

</script>


</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Don&#39;t Panic!</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-21T16:00:00.000Z"><a href="/2015/08/22/add-toc-indexes-to-pdf/">2015-08-22</a></time>
      
      
  
    <h1 class="title">Add TOC indexes to PDF</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="PDF-books-without-Indexes-are-like-Planets-with-Individuals"><a href="#PDF-books-without-Indexes-are-like-Planets-with-Individuals" class="headerlink" title="PDF books without Indexes are like Planets with Individuals"></a>PDF books without Indexes are like Planets with Individuals</h2><p>I prefer e-books to paper books, actually I may have read only 1-2 paper books in recent 3 years, while e-books of a much larger amount. The pros of e-books are really obvious:</p>
<ol>
<li>portability</li>
<li>context can be copied</li>
<li>easy to manage</li>
<li>easy to navigate</li>
</ol>
<p>I don’t want to argue about the superiorities here. I just wanna to convey that the 4th feature is a crucial one, and it is mainly achieved via indexes, bookmarks, reference links, etc. There’s no doubt that among those approaches, indexes play the most significant role. So I say that e-books without indexes are like planets with individuals, i.e. huge gaps among separated pieces of text.</p>
<a id="more"></a>
<h2 id="Indexes-Instrumentality-Project"><a href="#Indexes-Instrumentality-Project" class="headerlink" title="Indexes Instrumentality Project"></a>Indexes Instrumentality Project</h2><p>Well, if you encounter such planets, <code>Don&#39;t Panic!</code> Please pick up the holy weapons, smash the individuals and reunite them as a strongly connected conglomerate. You may need to carry these handy weapons:</p>
<ol>
<li>vim</li>
<li>pdftk</li>
</ol>
<h3 id="First-Impact"><a href="#First-Impact" class="headerlink" title="First Impact"></a>First Impact</h3><ol>
<li>Dissect the “<a href="http://wiki.evageeks.org/Black_Moon" target="_blank" rel="external">Black Moon</a>“ to get the seed of life <a href="http://wiki.evageeks.org/Lilith" target="_blank" rel="external">Lilith</a>, <code>pdftk earth.pdf dump_data &gt; Lilith</code></li>
<li>Next, form the <a href="http://wiki.evageeks.org/A.T._Field" target="_blank" rel="external">A.T. Field</a>, simply copy the catalog from the file. If it’s a scanned version, some kind of OCR weapon will help</li>
<li>Use vim to reshape (macros shall be helpful) the A.T. Field into the form of human egos, A.K.A. 心の壁:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 Chap1:title                 1</span><br><span class="line">1.1 Chap1-Sec1:title          4</span><br><span class="line">1.1.1 Chap1-Sec1-Para1:title  9</span><br><span class="line">1.1.2 xxxx                    10</span><br><span class="line">2 Chap2:title                 20</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="Destroy-the-A-T-Field-of-egos"><a href="#Destroy-the-A-T-Field-of-egos" class="headerlink" title="Destroy the A.T. Field of egos"></a>Destroy the A.T. Field of egos</h3><p>Piercing human egos with the <a href="http://wiki.evageeks.org/Spear_of_Longinus" target="_blank" rel="external">Spear of Longinus</a> (vimscript):</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:'&lt;,'&gt;s#\v(\s*)([0-9.]+ )(.* )(\d+)#\="BookmarkBegin\rBookmarkTitle: ".submatch(2).submatch(3)."\rBookmarkLevel: ".len(split(submatch(2), '\.'))."\rBookmarkPageNumber: ".(submatch(4)+offset)</span><br></pre></td></tr></table></figure>
<p>After that, souls of the following form will occur:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">BookmarkBegin</span><br><span class="line">BookmarkTitle: 1 Chap1:title</span><br><span class="line">BookmarkLevel: 1</span><br><span class="line">BookmarkPageNumber: 16</span><br><span class="line">BookmarkBegin</span><br><span class="line">BookmarkTitle: 1.1 Chap1-Sec1:title</span><br><span class="line">BookmarkLevel: 2</span><br><span class="line">BookmarkPageNumber: 19</span><br><span class="line">BookmarkBegin</span><br><span class="line">BookmarkTitle: 1.1.1 Chap1-Sec1-Para1:title</span><br><span class="line">BookmarkLevel: 3</span><br><span class="line">BookmarkPageNumber: 24</span><br><span class="line">BookmarkBegin</span><br><span class="line">BookmarkTitle: 1.1.2 xxxx</span><br><span class="line">BookmarkLevel: 3</span><br><span class="line">BookmarkPageNumber: 25</span><br><span class="line">BookmarkBegin</span><br><span class="line">BookmarkTitle: 2 Chap2:title</span><br><span class="line">BookmarkLevel: 1</span><br><span class="line">BookmarkPageNumber: 35</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ul>
<li>Here the “offset” is taken as 15, which means the very first page of the book lies in the 16th page of the PDF file due to the tedious bullshit at the beginning.</li>
<li>If no section numbers provided, indentations will be good indicators of the bookmark levels</li>
</ul>
<h3 id="Third-Impact"><a href="#Third-Impact" class="headerlink" title="Third Impact"></a>Third Impact</h3><ol>
<li>Souls shall be gathered into Lilith’s egg, <code>cat souls &gt;&gt; Lilith</code>.</li>
<li>Unite as a single existence, <code>pdftk earth.pdf update_info Lilith output reborn.pdf</code>.</li>
</ol>
<p>Done.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="http://vimdoc.sourceforge.net/htmldoc/change.html#sub-replace-expression" target="_blank" rel="external">vimdoc sub-replace-expression</a></li>
<li><a href="https://www.pdflabs.com/docs/pdftk-man-page/" target="_blank" rel="external">pdftk-man-page</a></li>
<li><a href="http://www.evangelion.co.jp/" target="_blank" rel="external">新世紀エヴァンゲリオン</a></li>
</ul>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/tweak/">tweak</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/vim/">vim</a>, <a href="/tags/EVA/">EVA</a>, <a href="/tags/中二病/">中二病</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
    
      <a class="addthis_button_tweet"></a>
    
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:farseer.cn">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/ML/">ML</a><small>6</small></li>
  
    <li><a href="/categories/PLT/">PLT</a><small>4</small></li>
  
    <li><a href="/categories/TCS/">TCS</a><small>2</small></li>
  
    <li><a href="/categories/fun/">fun</a><small>2</small></li>
  
    <li><a href="/categories/notes/">notes</a><small>1</small></li>
  
    <li><a href="/categories/tips/">tips</a><small>2</small></li>
  
    <li><a href="/categories/tweak/">tweak</a><small>3</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Coq/">Coq</a><small>1</small></li>
  
    <li><a href="/tags/EVA/">EVA</a><small>1</small></li>
  
    <li><a href="/tags/Information-theory/">Information theory</a><small>2</small></li>
  
    <li><a href="/tags/art/">art</a><small>1</small></li>
  
    <li><a href="/tags/distributed/">distributed</a><small>2</small></li>
  
    <li><a href="/tags/game/">game</a><small>1</small></li>
  
    <li><a href="/tags/haskell/">haskell</a><small>2</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>2</small></li>
  
    <li><a href="/tags/lambda-calculus/">lambda-calculus</a><small>2</small></li>
  
    <li><a href="/tags/logic/">logic</a><small>2</small></li>
  
    <li><a href="/tags/machine-learning/">machine learning</a><small>1</small></li>
  
    <li><a href="/tags/math/">math</a><small>3</small></li>
  
    <li><a href="/tags/ml/">ml</a><small>1</small></li>
  
    <li><a href="/tags/paper/">paper</a><small>2</small></li>
  
    <li><a href="/tags/physics/">physics</a><small>1</small></li>
  
    <li><a href="/tags/scala/">scala</a><small>1</small></li>
  
    <li><a href="/tags/shell/">shell</a><small>1</small></li>
  
    <li><a href="/tags/spark/">spark</a><small>1</small></li>
  
    <li><a href="/tags/statistics/">statistics</a><small>3</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>2</small></li>
  
    <li><a href="/tags/vimperator/">vimperator</a><small>3</small></li>
  
    <li><a href="/tags/zsh/">zsh</a><small>1</small></li>
  
    <li><a href="/tags/ツッコミ/">ツッコミ</a><small>1</small></li>
  
    <li><a href="/tags/中二病/">中二病</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 Farseer He
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'githubio';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>